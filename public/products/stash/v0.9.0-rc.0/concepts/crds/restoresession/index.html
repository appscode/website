<!doctype html><html lang=en><head><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-62096468-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content=#00A651><title>Stash Home</title><meta name=description content="Accelerating the transition to Containers by building a Kubernetes-native Cloud"><meta name=author content="AppsCode Inc."><meta name=keywords content="application monitoring,attic,build docker image,cloud app,cloud deployment,cloud hosting,container applications,continuous deployment,deployment automation,git hosting,kubernetes autoscaling,nagios,network monitor,repository hosting,source code repository"><link rel=apple-touch-icon sizes=57x57 href=/assets/images/products/appscode/icons/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/assets/images/products/appscode/icons/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/assets/images/products/appscode/icons/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/assets/images/products/appscode/icons/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/assets/images/products/appscode/icons/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/assets/images/products/appscode/icons/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/assets/images/products/appscode/icons/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/assets/images/products/appscode/icons/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/assets/images/products/appscode/icons/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/assets/images/products/appscode/icons/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/assets/images/products/appscode/icons/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/assets/images/products/appscode/icons/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/assets/images/products/appscode/icons/favicon-16x16.png><link rel=manifest href=/assets/images/products/appscode/icons/manifest.json><meta name=msapplication-TileColor content=#ffffff><meta name=msapplication-TileImage content=/assets/images/products/appscode/icons/ms-icon-144x144.png><meta name=twitter:card content=summary><meta name=twitter:site content=@AppsCodeHQ><meta name=twitter:title content="AppsCode Inc."><meta name=twitter:creator content=@AppsCodeHQ><meta name=twitter:description content="Accelerating the transition to Containers by building a Kubernetes-native Cloud"><meta name=twitter:image:src content=/assets/images/products/appscode/appscode-1280x640.png><meta property=og:url content=https://appscode.com><meta property=og:title content="AppsCode Inc."><meta property=og:description content="Accelerating the transition to Containers by building a Kubernetes-native Cloud"><meta property=og:site_name content="AppsCode Inc."><meta property=og:image content=/assets/images/products/appscode/appscode-1280x640.png><meta property=og:type content=article><link rel=stylesheet href=/assets/css/font-awesome.min.css><link rel=stylesheet href=/assets/css/bulma-carousel.min.css><link rel=stylesheet href=/assets/css/bulma-tooltip.min.css><link rel=stylesheet href=/assets/css/bulma.min.css><link rel=stylesheet href=/assets/sass/main.min.30172e50eb801cfc6b302d51c847a82070039d302285080f9ce0941921b8410e.css></head><body class=stash><header><div class="header-top fixed-menu-z-index"><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://appscode.com><img src=https://cdn.appscode.com/images/products/appscode/appscode.png alt=AppsCode></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav1><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav1 class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Products</a><div class=ac-megamenu><div class=columns><div class="column is-8"><div class=columns><div class="column is-6 br-1"><a href=https://kubedb.com class="single-product-item is-kubedb"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/kubedb/kubedb-icon.png alt=KubeDB></div><h5>KubeDB</h5></div><div class=menu-body><p>Run production-grade databases easily on Kubernetes</p></div></a><a href=https://appscode.com/products/stash/ class="single-product-item is-stash"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/stash/stash-icon.png alt=Stash></div><h5>Stash</h5></div><div class=menu-body><p>Backup your Kubernetes Stateful Applications</p></div></a><a href=https://kubevault.com class="single-product-item is-kubevault"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/kubevault/kubevault-icon.png alt=KubeVault></div><h5>KubeVault</h5></div><div class=menu-body><p>Tools for running HashiCorp Vault on Kubernetes</p></div></a><a href=https://appscode.com/products/guard/ class="single-product-item is-guard"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/guard/guard-icon.png alt=Guard></div><h5>Guard</h5></div><div class=menu-body><p>Kubernetes Authentication WebHook Server</p></div></a></div><div class="column is-6 br-1"><a href=https://appscode.com/products/voyager/ class="single-product-item is-voyager"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/voyager/voyager-icon.png alt=Voyager></div><h5>Voyager</h5></div><div class=menu-body><p>Secure HAProxy Ingress Controller for
Kubernetes</p></div></a><a href=https://appscode.com/products/swift/ class="single-product-item is-swift"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/swift/swift-icon.png alt=Swift></div><h5>Swift</h5></div><div class=menu-body><p>Ajax friendly Helm Tiller Proxy</p></div></a><a href=https://appscode.com/products/searchlight/ class="single-product-item is-searchlight"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/searchlight/searchlight-icon.png alt=Searchlight></div><h5>Searchlight</h5></div><div class=menu-body><p>Alerts for Kubernetes</p></div></a><a href=https://appscode.com/products/kubed/ class="single-product-item is-kubed"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/kubed/kubed-icon.png alt=Kubed></div><h5>Kubed</h5></div><div class=menu-body><p>Kubernetes cluster manager daemon</p></div></a></div></div></div><div class="column is-4"><div class=columns><div class="column is-12"><a href=https://byte.builders class="single-product-item byte-builder kd-orange"><div class=menu-header><p class=intro>Introducing....</p><h5>ByteBuilders</h5></div><div class=menu-body><p>Cloud reimagined for the age of Kubernetes</p></div><p class=learn-more-btn>Learn more
<span class=icon><i class="fa fa-long-arrow-right" aria-hidden=true></i></span></p></a><a href=https://pharmer.io class="single-product-item is-pharmer"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/pharmer/pharmer-icon.png alt=Pharmer></div><h5>Pharmer</h5></div><div class=menu-body><p>Kubernetes Cluster Manager using Kubeadm &amp; Cluster API</p></div></a><a href=https://kubeform.com class="single-product-item is-kubeform"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/kubeform/kubeform-icon.png alt=Kubeform></div><h5>Kubeform</h5></div><div class=menu-body><p>Provision cloud resources using Kubernetes CRDs &amp; Terraform</p></div></a></div></div></div></div><div class="columns has-text-centered"><div class=column><div class=menu-bottom><p>Explore apps and integrations for AppsCode products:
<a href=https://marketplace.byte.builders>Visit the Marketplace
<i class="fa fa-long-arrow-right" aria-hidden=true></i></a></p></div></div></div></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Services</a><div class=ac-dropdown><a class=navbar-item href=https://appscode.com/consulting/>Consulting</a>
<a class=navbar-item href=https://appscode.com/training/>Training</a>
<a class=navbar-item href=https://appscode.com/support/>Support</a></div></div><a class=navbar-item href=https://blog.byte.builders>Blog</a>
<a class=navbar-item href=https://appscode.com/contact/>Contact Us</a></div><div class=navbar-item><div class="buttons main-menu-button-top"><a class="button is-small for-chat" href=https://slack.appscode.com><span><img src=/assets/images/icon/slack.png alt></span>Slack</a>
<a class="button is-small for-support" href=https://appscode.freshdesk.com><span><img src=/assets/images/icon/chat.png alt></span>Support Portal</a></div></div></div></div></nav></div></div><div class="header-bottom-area header-area kubedb-primary-bg customize-kubedb  fixed-menu"><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://appscode.com/products/stash/><img src=https://cdn.appscode.com/images/products/stash/stash-white.png alt=Stash></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><a href=/products/stash/pricing/ class=navbar-item>Commercial Support</a>
<a href=/products/stash/v0.9.0-rc.0/welcome/ class=navbar-item>Documentation</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Community</a><div class=ac-dropdown><a href=https://github.com/stashed class=navbar-item>GitHub</a>
<a href=https://twitter.com/AppsCodeHQ class=navbar-item>Twitter</a>
<a href=https://slack.appscode.com class=navbar-item>Slack</a></div></div></div><div class=navbar-item><div class="buttons main-menu-button"><img style=height:24px alt="GitHub Stars" src="https://img.shields.io/github/stars/appscode/stash?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=github">
&nbsp;&nbsp;&nbsp;
<img style=height:24px alt="Docker Pulls" src="https://img.shields.io/docker/pulls/appscode/stash?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=docker"></div></div></div></div></nav></div></div><div class=documentation-menu><div class="container section"><div class=is-centered><div class="is-half has-text-centered-desktop"><div class=responsive-menu><a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav3><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><nav class=documentation-navbar><div id=acNav3 class="navbar-menu nav-menu main-menu"><div class=navbar-centered><div class=navbar-start><a href=/products/stash/v0.9.0-rc.0/ class=navbar-item>Welcome</a>
<a href=/products/stash/v0.9.0-rc.0/concepts/ class="is-active  navbar-item">Concepts</a>
<a href=/products/stash/v0.9.0-rc.0/setup/ class=navbar-item>Setup</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Guides</a><div class=ac-dropdown><a href=/products/stash/v0.9.0-rc.0/guides/latest/ class=navbar-item>Latest Guides</a>
<a href=/products/stash/v0.9.0-rc.0/guides/v1alpha1/ class=navbar-item>v1alpha1 Guides</a></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Reference</a><div class=ac-dropdown><a href=/products/stash/v0.9.0-rc.0/reference/operator/ class=navbar-item>Stash Operator</a></div></div><a href class=navbar-item>stash-postgres-guides</a></div></div></div></nav></div></div></div></div></header><div class=documentation-area><div class="container section"><div class=columns><div class="column is-3"><div class=kd-left-sidebar><div class=trial-button><a href=/products/stash/v0.9.0-rc.0/setup/ class="button is-fullwidth">Try Now for FREE!</a></div><div class=kd-version><div class=dropdown><div class=dropdown-trigger><button class="button is-fullwidth" aria-haspopup=true aria-controls=dropdown-menu3>
<span><strong class=icon><i class="fa fa-cog" aria-hidden=true></i></strong>v0.9.0-rc.0</span>
<span class=new-item>Latest</span>
<span class="icon is-small"><i class="fa fa-angle-down" aria-hidden=true></i></span></button></div><div class=dropdown-menu id=dropdown-menu3 role=menu><div class=dropdown-content><a href=https://github.com/stashed/docs/tree/master/docs target=_blank class=dropdown-item>master</a>
<a href=/products/stash/v0.9.0-rc.0/ class=dropdown-item>v0.9.0-rc.0<div class=tag>Latest</div></a><a href=/products/stash/0.8.3/ class=dropdown-item>0.8.3</a>
<a href=/products/stash/0.8.2/ class=dropdown-item>0.8.2</a>
<a href=/products/stash/0.8.1/ class=dropdown-item>0.8.1</a>
<a href=/products/stash/0.8.0/ class=dropdown-item>0.8.0</a>
<a href=/products/stash/0.7.0/ class=dropdown-item>0.7.0</a>
<a href=/products/stash/0.6.4/ class=dropdown-item>0.6.4</a>
<a href=https://github.com/stashed/docs/tree/0.4.2/docs target=_blank class=dropdown-item>0.4.2</a></div></div></div></div><div class=kd-sidebar-menu><div class=item><input type=checkbox id=269df7e24506cdbb5f66af164567550e-1>
<label for=269df7e24506cdbb5f66af164567550e-1><a href=/products/stash/v0.9.0-rc.0/concepts/>Concepts</a></label></div><div class=item><input type=checkbox id=269df7e24506cdbb5f66af164567550e-2>
<label for=269df7e24506cdbb5f66af164567550e-2><a>What is Stash</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/products/stash/v0.9.0-rc.0/concepts/what-is-stash/overview/>Overview</a></li><li><a href=/products/stash/v0.9.0-rc.0/concepts/what-is-stash/architecture/>Architecture</a></li></ul></div></div><div class=item><input type=checkbox id=269df7e24506cdbb5f66af164567550e-3 checked>
<label for=269df7e24506cdbb5f66af164567550e-3><a>Declarative API</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/products/stash/v0.9.0-rc.0/concepts/crds/repository/>Repository</a></li><li><a href=/products/stash/v0.9.0-rc.0/concepts/crds/backupconfiguration/>BackupConfiguration</a></li><li><a href=/products/stash/v0.9.0-rc.0/concepts/crds/backupsession/>BackupSession</a></li><li class=is-active><a href=/products/stash/v0.9.0-rc.0/concepts/crds/restoresession/>RestoreSession</a></li><li><a href=/products/stash/v0.9.0-rc.0/concepts/crds/function/>Function</a></li><li><a href=/products/stash/v0.9.0-rc.0/concepts/crds/task/>Task</a></li><li><a href=/products/stash/v0.9.0-rc.0/concepts/crds/backupblueprint/>BackupBlueprint</a></li><li><a href=/products/stash/v0.9.0-rc.0/concepts/crds/appbinding/>AppBinding</a></li><li><a href=/products/stash/v0.9.0-rc.0/concepts/crds/snapshot/>Snapshot</a></li></ul></div></div><div class=item><input type=checkbox id=269df7e24506cdbb5f66af164567550e-4>
<label for=269df7e24506cdbb5f66af164567550e-4><a>v1alpha1 API</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/products/stash/v0.9.0-rc.0/concepts/crds/v1alpha1/restic/>Restic</a></li><li><a href=/products/stash/v0.9.0-rc.0/concepts/crds/v1alpha1/recovery/>Recovery</a></li></ul></div></div></div></div></div><div class="column is-7"><div class=full-info><blockquote><p>New to Stash? Please start <a href=/products/stash/v0.9.0-rc.0/concepts/README>here</a>.</p></blockquote><h1 id=restoresession>RestoreSession</h1><h2 id=what-is-restoresession>What is RestoreSession</h2><p>A <code>RestoreSession</code> is a Kubernetes <code>CustomResourceDefinition</code>(CRD) which specifies a target to restore and the source of data that will be restored in a Kubernetes native way.</p><p>You have to create a <code>RestoreSession</code> object whenever you want to restore. When a <code>RestoreSession</code> object is created, Stash injects an <code>init-container</code> into the target workload and restarts it. The <code>init-container</code> restores the desired data. If the target is a database or a stand-alone PVC, Stash launches a job to perform the restore process.</p><h2 id=restoresession-crd-specification>RestoreSession CRD Specification</h2><p>Like any official Kubernetes resource, a <code>RestoreSession</code> has <code>TypeMeta</code>, <code>ObjectMeta</code>, <code>Spec</code> and <code>Status</code> sections.</p><p>A sample <code>RestoreSession</code> object to restore backed up data of a StatefulSet is shown below:</p><pre><code class=language-yaml>apiVersion: stash.appscode.com/v1beta1
kind: RestoreSession
metadata:
  name: statefulset-restore
  namespace: demo
spec:
  driver: Restic
  repository:
    name: local-repo
  # task:
  #   name: workload-restore # task field is not required for workload data restore but it is necessary for database restore.
  target:
    ref:
      apiVersion: apps/v1
      kind: StatefulSet
      name: recovered-statefulset
    volumeMounts:
    - mountPath: /source/data
      name: source-data
  rules:
  - targetHosts: [&quot;host-3&quot;,&quot;host-4&quot;] # &quot;host-3&quot; and &quot;host-4&quot; will have restored data of backed up host &quot;host-1&quot;
    sourceHost: &quot;host-1&quot; # source host
    paths:
    - /source/data
  - targetHosts: [] # empty host match all hosts
    sourceHost: &quot;&quot; # no source host indicates that the host is pod itself
    paths:
    - /source/data
  runtimeSettings:
    container:
      resources:
        limits:
          memory: 256M
        requests:
          memory: 256M
      securityContext:
        runAsGroup: 2000
        runAsUser: 2000
      ionice:
        class: 2
        classData: 4
      nice:
        adjustment: 5
    pod:
      imagePullSecrets:
      - name: my-private-registry-secret
      serviceAccountName: my-restore-svc
  tempDir:
    disableCache: false
    medium: Memory
    size: 2Gi
status:
  totalHosts: 5
  phase: Succeeded
  sessionDuration: 4.148288404s
  stats:
  - duration: 884.431745ms
    hostname: host-1
    phase: Succeeded
  - duration: 769.924342ms
    hostname: host-2
    phase: Succeeded
  - duration: 868.694738ms
    hostname: host-3
    phase: Succeeded
  - duration: 792.097784ms
    hostname: host-4
    phase: Succeeded
  - duration: 833.139795ms
    hostname: host-0
    phase: Succeeded
</code></pre><p>Here, we are going to describe the various sections of a <code>RestoreSession</code> object.</p><h3 id=restoresession-spec>RestoreSession <code>Spec</code></h3><p>A <code>RestoreSession</code> object has the following fields in the <code>spec</code> section.</p><h4 id=spec-driver>spec.driver</h4><p><code>spec.driver</code> indicates the mechanism used to restore a target. Currently, Stash supports <code>Restic</code> and <code>VolumeSnapshotter</code> as drivers. The default value of this field is <code>Restic</code>.</p><table><thead><tr><th>Driver</th><th>Usage</th></tr></thead><tbody><tr><td><code>Restic</code></td><td>Used to restore workload data, persistent volumes data and databases. It uses <a href=https://restic.net>restic</a> to restore the target.</td></tr><tr><td><code>VolumeSnapshotter</code></td><td>Used to initialize PersistentVolumeClaim from VolumeSnapshot. It leverages Kubernetes <a href=https://kubernetes.io/docs/concepts/storage/volume-snapshots/>VolumeSnapshot</a> crd and CSI driver to initialize the target PVCs from respective snapshots. Currently, it can restore only in new PVC.</td></tr></tbody></table><h4 id=spec-target>spec.target</h4><p><code>spec.target</code> field indicates the target where data will be restored. This section consists of the following fields:</p><ul><li><p><strong>spec.target.ref :</strong> <code>spec.target.ref</code> refers to the restore target. You have to specify <code>apiVersion</code>, <code>kind</code> and <code>name</code> of the target. Stash will use this information to inject an <code>init-container</code> or to create a restore job.</p></li><li><p><strong>spec.target.volumeMounts :</strong> <code>spec.target.volumeMounts</code> specifies a list of volumes and their <code>mountPath</code> where the data will be restored. Stash will mount these volumes inside the <code>init-container</code> or restore job.</p></li></ul><blockquote><p>Note: Stash stores absolute path of the backed up files. Hence, your restored volume must be mounted on the same <code>mountPath</code> as the original volume. Otherwise, the backed up files will not be restored into your desired volume.</p></blockquote><ul><li><p><strong>spec.target.volumeClaimTemplates :</strong> You can specify a list of PVC template using <code>spec.target.volumeClaimTemplates</code> field. Stash will create those PVCs then it will restore the desired data into them. Then, you can use those PVCs to deploy your desired workload.</p></li><li><p><strong>spec.target.replicas :</strong> If you want to restore the volumes of a StatefulSet through <code>spec.target.volumeClaimTemplate</code> field, you can specify the number of replicas of the StatefulSet using <code>spec.target.replicas</code>. In this case, you have to use <code>${POD_ORDINAL}</code> variable suffix in the claim name. Stash will replace that variable with respective ordinal and it will create the volumes for each replica. For more details, please visit <a href=/products/stash/v0.9.0-rc.0/guides/latest/advanced-use-case/clone-pvc#clone-the-volumes-of-a-satefulset>here</a>.</p></li></ul><h4 id=spec-repository>spec.repository</h4><p><code>spec.repository.name</code> indicates the <code>Repository</code> crd name that holds necessary backend information from where data will be restored.</p><h4 id=spec-task>spec.task</h4><p><code>spec.task</code> specifies the name and parameters of the <a href=/products/stash/v0.9.0-rc.0/concepts/crds/task>Task</a> crd to use to restore the target data.</p><ul><li><strong>spec.task.name:</strong> <code>spec.task.name</code> indicates the name of the <code>Task</code> template to use for this restore process.</li><li><strong>spec.task.params:</strong> <code>spec.task.params</code> is an array of custom parameters to use to configure the task.</li></ul><blockquote><p><code>spec.task</code> section is not necessary for restoring workload data (i.e. Deployment, DaemonSet, StatefulSet etc.). However, it is necessary for restoring database and stand-alone PVC.</p></blockquote><h4 id=spec-rules>spec.rules</h4><p><code>spec.rules</code> is an array of restore rules that specify how Stash should restore data for each host. For example, Stash runs restore process in all pod&rsquo;s of a StatefulSet. You can configure this <code>spec.rules</code> section to control what data will be restored into which pod.</p><p>Each restore rule has the following fields:</p><ul><li><strong>targetHosts :</strong> <code>targetHosts</code> field contains a list of host names which are subject to this rule. If <code>targetHosts</code> field is empty, this rule applies to all hosts for which there is no specific rule. In the sample <code>RestoreSession</code> given above, the first rule applies to only <code>host-3</code> and <code>host-4</code> and the second rule is applicable to all hosts.</li><li><strong>sourceHost :</strong> <code>sourceHost</code> specifies the name of host whose backed up data will be restored by this rule. In the sample <code>RestoreSession</code>, the first rule specify that backed up data of <code>host-0</code> (i.e. <code>pod-0</code> of old StatefulSet) will be restored into <code>host-3</code> and <code>host-4</code> (i.e. <code>pod-3</code> and <code>pod-4</code> of new StatefulSet). If you keep <code>sourceHost</code> field empty as the second rule of the above example, data from a similar restore host will be restored on the respective restore host. That means, backed up data of <code>host-0</code> will be restored into <code>host-0</code>, backed up data of <code>host-1</code> will be restored into <code>host-1</code> and so on.</li><li><strong>paths :</strong> <code>paths</code> specifies a list of file paths that will be restored into the hosts who are subject to this rule.</li><li><strong>snapshots :</strong> <code>snapshots</code> specifies the list of snapshots that will be restored into the hosts who are subject to this rule. If you don&rsquo;t specify snapshot field, latest snasphot of the file paths specified in <code>paths</code> section will be restored.</li></ul><p>Restore rules comply with the following conditions:</p><ul><li>There could be at most one rule with empty <code>targetHosts</code> field.</li><li>No two rules with non-emtpy <code>targetHosts</code> can&rsquo;t be matched for a single host.</li><li>Stash restore only one file path in a single snapshot. So, if you specify <code>snapshots</code> field in a rule, you can&rsquo;t specify <code>paths</code> field as it may cause restore failure if a file path wasn&rsquo;t backed up in the snapshot specified in the <code>snapshots</code> field.</li><li>If no rule matches for a host, no data will be restored on that host.</li><li>The order of the rules does not have any effect on the restore process.</li></ul><h4 id=spec-runtimesettings>spec.runtimeSettings</h4><p><code>spec.runtimeSettings</code> allows to configure runtime environment for restore <code>init-container</code> or job. You can specify runtime settings in both pod level and container level.</p><ul><li><strong>spec.runtimeSettings.container</strong></li></ul><p><code>spec.runtimeSettings.container</code> is used to configure restore init-container/job in container level. You can configure the following container level parameters,</p><table><thead><tr><th align=center>Field</th><th>Usage</th></tr></thead><tbody><tr><td align=center><code>resources</code></td><td>Compute resources required by restore init-container or restore job. To know how to manage resources for containers, please visit <a href=https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/>here</a>.</td></tr><tr><td align=center><code>livenessProbe</code></td><td>Periodic probe of restore init-container/job&rsquo;s container liveness. Container will be restarted if the probe fails.</td></tr><tr><td align=center><code>readinessProbe</code></td><td>Periodic probe of restore init-container/job&rsquo;s container readiness. Container will be removed from service endpoints if the probe fails.</td></tr><tr><td align=center><code>lifecycle</code></td><td>Actions that the management system should take in response to container lifecycle events.</td></tr><tr><td align=center><code>securityContext</code></td><td>Security options that restore init-container/job&rsquo;s container should run with. For more details, please visit <a href=https://kubernetes.io/docs/concepts/policy/security-context/>here</a>.</td></tr><tr><td align=center><code>nice</code></td><td>Set CPU scheduling priority for the restore process. For more details about <code>nice</code>, please visit <a href=https://www.askapache.com/optimize/optimize-nice-ionice/#nice>here</a>.</td></tr><tr><td align=center><code>ionice</code></td><td>Set I/O scheduling class and priority for the restore process. For more details about <code>ionice</code>, please visit <a href=https://www.askapache.com/optimize/optimize-nice-ionice/#ionice>here</a>.</td></tr><tr><td align=center><code>env</code></td><td>A list of the environment variables to set in the restore init-container/job&rsquo;s container.</td></tr><tr><td align=center><code>envFrom</code></td><td>This allows to set environment variables to the the restore init-container/job&rsquo;s container from a Secret or ConfigMap.</td></tr></tbody></table><ul><li><strong>spec.runtimeSettings.pod</strong></li></ul><p><code>spec.runtimeSettings.pod</code> is used to configure restore job in pod level. You can configure following pod level parameters,</p><table><thead><tr><th>Field</th><th>Usage</th></tr></thead><tbody><tr><td><code>serviceAccountName</code></td><td>Name of the <code>ServiceAccount</code> to use for restore job. Stash init-container will use the same <code>ServiceAccount</code> as the target.</td></tr><tr><td><code>nodeSelector</code></td><td>Selector which must be true for restore job pod to fit on a node.</td></tr><tr><td><code>automountServiceAccountToken</code></td><td>Indicates whether a service account token should be automatically mounted into the restore job&rsquo;s pod.</td></tr><tr><td><code>nodeName</code></td><td>NodeName is used to request to schedule restore job&rsquo;s pod onto a specific node.</td></tr><tr><td><code>securityContext</code></td><td>Security options that restore job&rsquo;s pod should run with. For more details, please visit <a href=https://kubernetes.io/docs/tasks/configure-pod-container/security-context/>here</a>.</td></tr><tr><td><code>imagePullSecrets</code></td><td>A list of secret names in the same namespace that will be used to pull image from private docker registry. For more details, please visit <a href=https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/>here</a>.</td></tr><tr><td><code>affinity</code></td><td>Affinity and anti-affinity to schedule restore job&rsquo;s pod in the desired node. For more details, please visit <a href=https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity>here</a>.</td></tr><tr><td><code>schedulerName</code></td><td>Name of the scheduler that should dispatch the restore job.</td></tr><tr><td><code>tolerations</code></td><td>Taints and Tolerations to ensure that restore job&rsquo;s pod is not scheduled in inappropriate nodes. For more details about <code>toleration</code>, please visit <a href=https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/>here</a>.</td></tr><tr><td><code>priorityClassName</code></td><td>Indicates the restore job pod&rsquo;s priority class. For more details, please visit <a href=https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/>here</a>.</td></tr><tr><td><code>priority</code></td><td>Indicates the restore job pod&rsquo;s priority value.</td></tr><tr><td><code>readinessGates</code></td><td>Specifies additional conditions to be evaluated for Pod readiness. For more details, please visit <a href=https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-readiness-gate>here</a>.</td></tr><tr><td><code>runtimeClassName</code></td><td>RuntimeClass is used for selecting the container runtime configuration. For more details, please visit <a href=https://kubernetes.io/docs/concepts/containers/runtime-class/>here</a></td></tr><tr><td><code>enableServiceLinks</code></td><td>EnableServiceLinks indicates whether information about services should be injected into pod&rsquo;s environment variables.</td></tr></tbody></table><h4 id=spec-tempdir>spec.tempDir</h4><p>Stash mounts an <code>emptyDir</code> for holding temporary files. It is also used for <code>caching</code> for faster restore performance. You can configure the <code>emptyDir</code> using <code>spec.tempDir</code> section. You can also disable <code>caching</code> using this field. The following fields are configurable in <code>spec.tempDir</code> section:</p><ul><li><strong>spec.tempDir.medium :</strong> Specifies the type of storage medium should back this file path.</li><li><strong>spec.tempDir.sizeLimit :</strong> Maximum limit of storage for this volume.</li><li><strong>spec.tempDir.disableCaching :</strong> Disable caching while restoring. This may negatively impact restore performance. This field is set to <code>false</code> by default.</li></ul><h3 id=restoresession-status>RestoreSession <code>Status</code></h3><p><code>.status</code> section of <code>RestoreSession</code> shows progress, stats and overall phase of the restore process. The restore init-container or job adds its respective stats in <code>.status</code> section after it completes its task. <code>.status</code> section consists of the following fields:</p><h4 id=status-totalhosts>status.totalHosts</h4><p>Not every pods or replica of the target will run restore process. Thus, we refer those entities that runs restore process as a host. <code>status.totalHosts</code> specifies the total number of hosts that will run restore process for this RestoreSession. For more details on how many hosts will run restore process for which types of workload, please visit <a href=#hosts-of-a-restore-process>here</a>.</p><h4 id=status-phase>status.phase</h4><p><code>status.phase</code> indicates the overall phase of the restore process for this RestoreSession. <code>status.phase</code> will be <code>Succeeded</code> only if the phase of all hosts are <code>Succeeded</code>. If any of the hosts fail to complete restore, <code>status.phase</code> will be <code>Failed</code>.</p><h4 id=status-sessionduration>status.sessionDuration</h4><p><code>status.sessionDuration</code> indicates the total time taken to complete the restoration of all hosts.</p><h4 id=status-stats>status.stats</h4><p><code>status.stats</code> section is an array of restore statistics of individual hosts. Each host adds their statistics in this array after completing their restore process. This field is only available for the <code>Restic</code> driver but not available for the <code>VolumeSnapshotter</code> driver. The default value of the driver is <code>Restic</code>.</p><p>Individual host stats entry consists of the following fields:</p><ul><li><strong>hostname :</strong> <code>hostname</code> indicates the name of the host.</li><li><strong>phase :</strong> <code>phase</code> indicates the restore phase of this host.</li><li><strong>duration :</strong> <code>duration</code> indicates the total time taken to complete restore process for this host.</li><li><strong>error :</strong> <code>error</code> shows the reason for failure if the restore process fails for this host.</li></ul><h3 id=hosts-of-a-restore-process>Hosts of a restore process</h3><p>Stash uses two different models for restoring backed up data depending on the target type. It uses <strong>init-container model</strong> for Kubernetes workloads and <strong>job model</strong> for rest of the targets. In the init-container model, Stash injects an init-container inside the targeted workload and the init-container is responsible for restoring the desired data on workload restart. In the job model, Stash launches a job to restore the desired data.</p><p>Stash uses an identifier called <strong>host</strong> to identify the entity where the restore process will be run. This host identification process depends on the restore model and the target types. The restore strategy and host identification strategy for different types of target is explained below.</p><p><strong>Kubernetes Workloads:</strong></p><p>Stash uses init-container model to restore Kubernetes workloads. However, not every init-container will run restore process. How many init-containers will run restore process depends on the type of the workload. We can divide them into the following categories:</p><ul><li><strong>Deployment, ReplicaSet and ReplicationController:</strong> For these types of stateless workloads, all the replicas mount the same volumes. So, restoring into only one replica is enough. In this case, Stash uses leader election to elect the leader pod. Only the init-container inside the leader pod runs the restore process. This leader pod is identified as <strong>host-0</strong>. The total number of hosts for these types of workloads is 1.</li><li><strong>StatefulSet:</strong> Every replica of a StatefulSet mounts different volumes. So, restoring into each replica is necessary. In this case, init-container inside each replica runs the restore process. Stash identifies <strong>pod-0</strong> as <strong>host-0</strong>, <strong>pod-1</strong> as <strong>host-1</strong>, <strong>pod-2</strong> as <strong>host-2</strong> and so on. Hence, the total number of hosts for a StatefulSet is the number of replicas.</li><li><strong>DaemonSet:</strong> Daemon replicas on every node may contain different data. So, restoring into each daemon pod is necessary. In this case, init-container inside each daemon pod runs the restore process. Stash considers the individual daemon pod as a separate host and the <strong>node name</strong> where the daemon pod is running act as their <strong>host</strong> identifier. The total number of hosts for a DaemonSet is the number of daemon pod running in the cluster.</li></ul><p><strong>Stand-alone PVC:</strong></p><p>Stash uses job model to restore a stand-alone PVC. Stash launches a job to restore into the targeted PVC. This job is identified as <strong>host-0</strong>. In this case, the total number of host is 1.</p><p><strong>Databases:</strong></p><p>Stash uses job model to restore a database. Stash launches a job to restore into the targeted database. In this case, the number of hosts depends on the database type.</p><ul><li><strong>Stand-alone database:</strong> For stand-alone database, the restore target is identified as <strong>host-0</strong> and the total number of host is 1.</li><li><strong>Replicated cluster:</strong> For replicated clustered database such as MongoDB ReplicaSet, all the replicas contain the same data. In this case, Stash restores same data into each replica. Thus, the total number of host is 1 and it is identified as <strong>host-0</strong>.</li><li><strong>Sharded cluster:</strong> For sharded database cluster, Stash restores the backed up data of individual shard into the respective shard. Hence, the number of hosts for a sharded database is the number of shards and they are identified as <strong>host-0</strong>, <strong>host-1</strong>, <strong>host-2</strong>, etc. However, the number of hosts may increase based on the database type.</li></ul><p><strong>VolumeSnapshot:</strong></p><p>Stash uses job model for restoring volume from volume snapshots. Each volume is considered a different host and they are identified by their name. Hence, the number of total hosts is the number of targeted volumes to be restored.</p><p><strong>Restore using volumeClaimTemplates:</strong></p><p>If <code>volumeClaimTemplates</code> is specified in a RestoreSession, Stash creates the PVCs according to the template then it launches one job for each replica specified by <code>spec.target.replicas</code> field. In this case, the total number of hosts is number of replicas specified by <code>spec.target.replicas</code> field. If this field is not provided then the total number of hosts is 1.</p><h2 id=next-steps>Next Steps</h2><ul><li>Learn how restore of workloads data works from <a href=/products/stash/v0.9.0-rc.0/guides/latest/workloads/overview>here</a>.</li><li>Learn how restore of databases works from <a href=/products/stash/v0.9.0-rc.0/guides/latest/databases/overview>here</a>.</li><li>Learn how restore stand-alone PVC works from <a href=/products/stash/v0.9.0-rc.0/guides/latest/volumes/overview>here</a>.</li></ul></div></div><div class="column is-2"><div class=right-sidebar-area><div class=search-area><form action=#><input id=acSearch type=text placeholder=Search...>
<button class=search-button>
<i class="fa fa-search" aria-hidden=true></i></button></form></div><div class=tbl-of-contents><h4>What's on this Page</h4><nav id=TableOfContents><ul><li><a href=#restoresession>RestoreSession</a><ul><li><a href=#what-is-restoresession>What is RestoreSession</a></li><li><a href=#restoresession-crd-specification>RestoreSession CRD Specification</a><ul><li><a href=#restoresession-spec>RestoreSession <code>Spec</code></a><ul><li><a href=#spec-driver>spec.driver</a></li><li><a href=#spec-target>spec.target</a></li><li><a href=#spec-repository>spec.repository</a></li><li><a href=#spec-task>spec.task</a></li><li><a href=#spec-rules>spec.rules</a></li><li><a href=#spec-runtimesettings>spec.runtimeSettings</a></li><li><a href=#spec-tempdir>spec.tempDir</a></li></ul></li><li><a href=#restoresession-status>RestoreSession <code>Status</code></a><ul><li><a href=#status-totalhosts>status.totalHosts</a></li><li><a href=#status-phase>status.phase</a></li><li><a href=#status-sessionduration>status.sessionDuration</a></li><li><a href=#status-stats>status.stats</a></li></ul></li><li><a href=#hosts-of-a-restore-process>Hosts of a restore process</a></li></ul></li><li><a href=#next-steps>Next Steps</a></li></ul></li></ul></nav></div></div></div></div></div><script>var kdDropdown=document.querySelector(".dropdown");var kdDropdownBtn=document.querySelector(".dropdown-trigger");kdDropdownBtn.addEventListener("click",function(){kdDropdown.classList.toggle("is-active");})</script></div><div class=overlay-bg></div><div class=sidebar-search-area><div class=search-area-top><h3>Search</h3><div class=searchbar-area><input type=search name=search id=searchbox placeholder=Search...>
<button onclick=queryPage(1)><i class="fa fa-search" aria-hidden=true></i></button></div><span id=searchbar-script-container style=display:none></span><div class="search-meta-information level"><div class=level-left></div></div></div><div class=search-result-wrapper></div><div class=pagination-area><div class=pagination-list></div></div></div><script type=text/javascript>var pageSize=5;var acSearch=document.querySelector("#acSearch");var bodyOverlay=document.querySelector(".overlay-bg");var sidebarSearch=document.querySelector(".sidebar-search-area");acSearch.addEventListener("click",function(){bodyOverlay.style.display="block";sidebarSearch.style.right="0";document.getElementById("searchbox").focus();bodyOverlay.addEventListener("click",function(){bodyOverlay.style.display="none";sidebarSearch.style.right="-80%";});});function encodeQueryData(data){var ret=[];for(var d in data)
ret.push(encodeURIComponent(d)+'='+encodeURIComponent(data[d]));return ret.join('&');}
document.querySelector(".searchbar-area input[type=search]").addEventListener("keyup",function(event){event.preventDefault();if(event.keyCode===13){queryPage(1);}});function queryPage(idx){var q=document.getElementById("searchbox").value;var cx="015199383701854252104:jccvu4eiulw";var key="AIzaSyBo15AW3hatf4fO8actJUZ_d5qZJpx0rXM";var imgSize="small";var callback="renderResult";var src="https://www.googleapis.com/customsearch/v1?"+encodeQueryData({q:q,cx:cx,key:key,imgSize:imgSize,callback:callback,start:(idx-1)*pageSize+1,num:pageSize,});var newScript=document.createElement("script");newScript.src=src;e=document.getElementById("searchbar-script-container");var child=e.lastElementChild;if(child){e.removeChild(child);}
e.appendChild(newScript);}
function renderSearchResultEntry(e){var out='<div class="single-search-result">'+
'<h3><a href="'+e.link+'">'+e.title+'</a></h3>'+
'<a href="'+e.link+'">'+e.htmlFormattedUrl+'</a>'+
'<div class="result-description-wrapper">';if(e.pagemap&&e.pagemap.cse_thumbnail){out+='<div class="result-thumb">'+
'<img src="'+e.pagemap.cse_thumbnail[0].src+'" alt="" />'+
'</div>';}
out+='<div class="result-description">'+
'<p>'+
e.snippet+
'</p>'+
'</div>'+
'</div>'+
'</div>';return out;}
function renderResult(response){document.querySelector(".search-meta-information .level-left").innerHTML='<div class="level-left">'+
'<p>'+
'About <span class="search-count">'+response.searchInformation.formattedTotalResults+'</span> results (<span class="time-count">'+response.searchInformation.formattedSearchTime+' </span>seconds)'+
'</p>'+
'</div>';if(!response.items){return;}
var searchResultWrapper=document.querySelector(".search-result-wrapper");searchResultWrapper.innerHTML="";for(var i=0;i<response.items.length;i++){searchResultWrapper.innerHTML+=renderSearchResultEntry(response.items[i]);}
var pager='<ul>';if(response.queries.previousPage){var pageIndex=Math.floor(response.queries.previousPage[0].startIndex/pageSize)+1;pager+='<li><a href="#" onclick="queryPage('+pageIndex+')">Previous</a></li>';}
if(response.queries.request){var pageIndex=Math.floor(response.queries.request[0].startIndex/pageSize)+1;pager+='<li><a href="#" onclick="queryPage('+pageIndex+')" class="is-active">'+pageIndex+'</a></li>';}
if(response.queries.nextPage){var pageIndex=Math.floor(response.queries.nextPage[0].startIndex/pageSize)+1;pager+='<li><a href="#" onclick="queryPage('+pageIndex+')">Next</a></li>';}
pager+='</ul>';document.querySelector(".pagination-area .pagination-list").innerHTML=pager;}</script><section></section><section></section><section></section><button class=go-to-top id=goTop>
<i class="fa fa-angle-up" aria-hidden=true></i></button><footer class=footer-area><div class=footer-top><div class="container section"><div class=columns><div class="column is-4"><div class=single-footer-widget><div class=footer-logo><a href=https://appscode.com><img src=https://cdn.appscode.com/images/products/appscode/appscode.png alt=AppsCode class=img></a></div><div class=subscription-form><form action="https://appscode.us17.list-manage.com/subscribe/post?u=feb2bf31969a951e7449048a3&amp;id=82fb19acb9" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=navbar-form target=_blank novalidate role=email role=email><label for=email>Subscribe to Our Newsletter</label><p class=spam-message>No spam, we promise. Your mail address is secure</p><div class="field has-addons"><div class=control><input class=input name=EMAIL id=mce-EMAIL type=email placeholder="Your work email address" required>
<button id=mc-embedded-subscribe type=submit name=subscribe class=button>
<i class="fa fa-paper-plane-o" aria-hidden=true></i></button></div></div></form></div><div class=contact-information><h4>Have any Inquiry?</h4><ul class=all-contact-info><li><a href=callto:&#43;1%28650%29241-8486><span><i class="fa fa-phone" aria-hidden=true></i></span>&#43;1(650)241-8486</a></li><li><a href=mailto:support@appscode.com><span><i class="fa fa-envelope-o" aria-hidden=true></i></span>support@appscode.com</a></li></ul></div></div></div><div class="column is-2"><div class=single-footer-widget><div class=footer-menu><h4>Products</h4><ul class=footer-link><li><a href=https://kubedb.com>KubeDB</a></li><li><a href=https://appscode.com/products/stash/>Stash</a></li><li><a href=https://kubevault.com>KubeVault</a></li><li><a href=https://appscode.com/products/voyager/>Voyager</a></li><li><a href=https://appscode.com/products/guard/>Guard</a></li><li><a href=https://pharmer.io>Pharmer</a></li></ul></div></div></div><div class="column is-2"><div class=single-footer-widget><div class=footer-menu><h4>Services</h4><ul class=footer-link><li><a href=https://appscode.com/pricing/>Commercial Support</a></li><li><a href=https://appscode.com/consulting/>Consulting</a></li><li><a href=https://appscode.com/training/>Training</a></li><li><a href=https://appscode.com/support/>Support</a></li></ul></div></div></div><div class="column is-2"><div class=single-footer-widget><div class=footer-menu><h4>Company</h4><ul class=footer-link><li><a href=https://appscode.com/about/>About Us</a></li><li><a href=https://blog.byte.builders>Blog</a></li><li><a href=https://appscode.com/contact/>Contact Us</a></li></ul></div></div></div><div class="column is-2"><div class=single-footer-widget><div class=footer-menu><h4>Legal</h4><ul class=footer-link><li><a href=https://appscode.com/legal/tos/>Terms of Sevice</a></li><li><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a></li><li><a href=https://appscode.com/legal/security/>Security</a></li><li><a href=https://appscode.com/legal/sla/>Service Level Agreement</a></li></ul></div></div></div></div></div></div><div class=footer-bottom><div class="container section"><div class=columns><div class="column is-4"><p>Â© 2019 AppsCode Inc. All rights reserved.</p></div><div class="column is-4 is-mobile has-text-centered"><div class=footer-inline-link><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a>
<a href=https://appscode.com/legal/tos/>Terms of Service</a></div></div><div class="column is-4 is-mobile has-text-right"><div class=socail-link-inline><ul><li><a href=https://twitter.com/AppsCodeHQ target=_blank><i class="fa fa-twitter" aria-hidden=true></i></a></li><li><a href=https://www.facebook.com/appscode target=_blank><i class="fa fa-facebook" aria-hidden=true></i></a></li><li><a href=https://www.youtube.com/c/AppsCodeInc target=_blank><i class="fa fa-youtube" aria-hidden=true></i></a></li></ul></div></div></div></div></div></footer><script src=/assets/js/bulma-carousel.min.js></script><script src=/assets/js/main.js></script></body></html>